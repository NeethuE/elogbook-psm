<!DOCTYPE html>
<html>
<head>
  <title>Faculty Review Panel</title>
  <script type="module" src="firebase-config.js"></script>
</head>
<body>
  <h2>Faculty Review Panel</h2>
  <div id="entryContainer">Loading entries...</div>

  <script type="module">
    import { db } from './firebase-config.js';
    import { collection, getDocs, updateDoc, doc } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    const entryContainer = document.getElementById('entryContainer');
    const snapshot = await getDocs(collection(db, 'logbookEntries'));
    entryContainer.innerHTML = '';

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const div = document.createElement('div');
      div.innerHTML = `
        <hr><strong>Name:</strong> ${data.name}<br>
        <strong>Roll:</strong> ${data.roll}<br>
        <strong>Date:</strong> ${data.date}<br>
        <strong>Location:</strong> ${data.location}<br>
        <strong>Competency:</strong> ${data.competency}<br>
        <strong>Activity:</strong> ${data.activity}<br>
        <img src="${data.diagramUrl}" width="200"><br>
        <textarea id="fb_${docSnap.id}" placeholder="Faculty Feedback">${data.feedback || ''}</textarea><br>
        <button onclick="saveFeedback('${docSnap.id}')">Save Feedback</button>
        <br><br>
      `;
      entryContainer.appendChild(div);
    });

    window.saveFeedback = async function(id) {
      const val = document.getElementById('fb_' + id).value;
      const ref = doc(db, 'logbookEntries', id);
      await updateDoc(ref, { feedback: val });
      alert('Feedback saved');
    }
  </script>
</body>
</html>
